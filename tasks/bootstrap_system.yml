---
# Определяем систему
- name: ETCD | Loading platform variables
  include_vars: "{{ ansible_os_family|lower }}.yml"

- name: ETCD | Print interpreter version
  debug:
    msg: "Python version = {{ ansible_python_version }}"

# Установка дополнительных пакетов
- name: ETCD | Install the packages
  package:
    name: "{{ item }}"
    state: present
  loop: "{{ etcd_required_packages.python2 }}"
  when:
    - cert_provider == 'ssl'
    - ansible_python.version.major|int == 2

# Установка дополнительных пакетов
- name: ETCD | Install the packages
  package:
    name: "{{ item }}"
    state: present
  loop: "{{ etcd_required_packages.python3 }}"
  when:
    - cert_provider == 'ssl'
    - ansible_python.version.major|int == 3

# Создаем группу
# Если:
## Группа не root
- name: ETCD | Create user group
  group:
    name: "{{ etcd_group }}"
  when:
    - etcd_group != "root"
    - etcd_manage_user|default(false)

# Создаем пользователя
# Если:
## Пользователь не root
- name: ETCD | Create user
  user:
    name: "{{ etcd_user }}"
    groups: "{{ etcd_group }}"
    generate_ssh_key: "{{ etcd_ssh_key }}"
    shell: "{{ etcd_shell }}"
    system: "{{ etcd_system }}"
    create_home: false
  when:
    - etcd_user != "root"
    - etcd_manage_user|default(false)
